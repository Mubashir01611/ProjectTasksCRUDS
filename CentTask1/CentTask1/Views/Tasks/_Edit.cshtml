@model CentTask1.ViewModels.TaskViewModels.TaskDetailViewModel;
 
    <style >
    /* Fix Select2 input border and alignment */
    .select2-container--bootstrap5 .select2-selection {
        border: 1px solid #ced4da !important;
        border-radius: 0.375rem !important;
        padding: 0.375rem 0.75rem !important;
        height: auto !important;
        min-height: 38px;
        display: flex;
        align-items: center;
    }

    .select2-container--bootstrap5 .select2-selection__rendered {
        line-height: normal !important;
        padding-left: 0 !important;
    }

    .select2-container--bootstrap5 .select2-selection__arrow {
        top: 50% !important;
        transform: translateY(-50%);
    } 

</style>
<form asp-action="Edit" asp-controller="Tasks" method="post" class="createOrEditForm" id="editProjectTaskForm">

    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <input type="hidden" asp-for="Id" />


    <div class="row">
        <div class="col-md-6 mb-3">
            <label asp-for="TaskName" class="form-label float-start">Task Name <span class="text-danger">*</span></label>
            <input asp-for="TaskName" class="form-control" />
            <span asp-validation-for="TaskName" class="text-danger"></span>
        </div>


        <div class="col-md-6 mb-3">
            <label asp-for="Description" class="form-label float-start">Description</label>
            <input asp-for="Description" class="form-control" />
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label asp-for="StartDate" class="form-label float-start">Start Date <span class="text-danger">*</span></label>
            <input type="date" asp-for="StartDate" class="form-control datepicker" placeholder="dd/mm/yyyy" />
            <span asp-validation-for="StartDate" class="text-danger"></span>
        </div>

        <div class="col-md-6 mb-3">
            <label asp-for="EndDate" class="form-label float-start">End Date <span class="text-danger">*</span></label>
            <input type="date" asp-for="EndDate" class="form-control datepicker" placeholder="dd/mm/yyyy" />
            <span asp-validation-for="EndDate" class="text-danger"></span>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label asp-for="TWR" class="form-label float-start">TWR</label>
            <input asp-for="TWR" class="form-control" />
            <span asp-validation-for="TWR" class="text-danger"></span>
        </div>

        <div class="col-md-6 mb-3">
            <label asp-for="Priority" class="form-label float-start">Priority</label>
            <input asp-for="Priority" class="form-control" />
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label asp-for="EquipmentType" class="form-label float-start">Equipment Type</label>
            <input asp-for="EquipmentType" class="form-control" />
        </div>

        <div class="col-md-6 mb-3">
            <label asp-for="ProjectId" class="form-label ">Project</label>
            <select asp-for="ProjectId" class="form-select js-select2" id="projectSelect">
                <option value="">Select a project</option>
                @if (Model.ProjectId != null)
                {
                    var selectedText = Model.ProjectName ?? "Selected Project";
                    <option value="@Model.ProjectId" selected>@selectedText</option>
                }
            </select>
            <span asp-validation-for="ProjectId" class="text-danger"></span>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-6">
            <a class="btn btn-outline-danger w-75" data-bs-dismiss="modal">Cancel</a>

        </div>
        <div class="col-md-6">
            <input type="submit" value="Save" name="submit"
                   class="btn btn-primary  w-75 submitForm"
                   data-url="/Tasks/Edit"
                    data-form-id="editProjectTaskForm" />
                    @* id="submitProjectTaskEditForm"  *@

        </div>
    </div>

</form>

<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        // This script will initialize Select2 if the partial is loaded directly.
        // When the partial is injected into the modal via AJAX the parent script also initializes,
        // but keeping this ensures it works when the partial is used standalone.
        (function () {
            if (typeof $ === 'undefined' || !$('#projectSelect').length) return;

            $('#projectSelect').select2({
                theme: 'bootstrap5', // adjust to bootstrap4 if you're using bootstrap4
                placeholder: 'Search and select a project',
                allowClear: true,
                dropdownParent: $('#createOrEditProjectTask'),
                ajax: {
                    url: '/Tasks/GetProjectsForDropdown',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return { term: params.term };
                    },
                    processResults: function (data) {
                        return { results: data.results };
                    }
                }
            });
        })();
    </script>
}